<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
                      <html>
                    <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
                    <title>ProVerif: process 1</title>
                    <link rel="stylesheet" href="cssproverif.css">
                                                                           </head>
                                                                         <body>
                                                                         <H1>Process 1 (<A HREF="process_0.html" TARGET="process">process 0</A>, with let moved downwards)</H1>
<a name=occ1 class="occ">{1}</a> <span class="keyword">new</span> <span class="name">devEUI</span>: <span class="type">bitstring</span>;<br>
<a name=occ2 class="occ">{2}</a> <span class="keyword">new</span> <span class="name">appEUI</span>: <span class="type">bitstring</span>;<br>
(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ5 class="occ">{5}</a> <span class="keyword">new</span> <span class="name">privEK_ED</span>: <span class="type">exponent</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ7 class="occ">{7}</a> <span class="keyword">event</span> <span class="fun">EDsendmessage1</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ6 class="occ">{6}</a> <span class="keyword">let</span> <span class="var">pubEK_ED</span>: <span class="type">G</span> = <span class="fun">exp</span>(<span class="fun">g</span>,<span class="name">privEK_ED</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ4 class="occ">{4}</a> <span class="keyword">let</span> <span class="var">appEUI_1</span>: <span class="type">bitstring</span> = <span class="name">appEUI</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ3 class="occ">{3}</a> <span class="keyword">let</span> <span class="var">devEUI_1</span>: <span class="type">bitstring</span> = <span class="name">devEUI</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ8 class="occ">{8}</a> <span class="keyword">out</span>(<span class="name">c</span>, <span class="fun"></span>(<span class="var">pubEK_ED</span>,<span class="var">devEUI_1</span>,<span class="var">appEUI_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ10 class="occ">{10}</a> <span class="keyword">in</span>(<span class="name">c</span>, <span class="fun"></span>(<span class="var">pubEK_AS</span>: <span class="type">G</span>,=<span class="var">appEUI_1</span>,<span class="var">ciphertext_2</span>: <span class="type">bitstring</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ11 class="occ">{11}</a> <span class="keyword">event</span> <span class="fun">EDgetmessage2</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ9 class="occ">{9}</a> <span class="keyword">let</span> <span class="var">intermediateHash</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">pubEK_ED</span>,<span class="var">devEUI_1</span>,<span class="var">appEUI_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ13 class="occ">{13}</a> <span class="keyword">let</span> <span class="var">TH_2</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">intermediateHash</span>,<span class="var">pubEK_AS</span>,<span class="var">appEUI_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ12 class="occ">{12}</a> <span class="keyword">let</span> <span class="var">PRK_2e</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="fun">emptyextractKey</span>,<span class="fun">exp</span>(<span class="var">pubEK_AS</span>,<span class="name">privEK_ED</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ14 class="occ">{14}</a> <span class="keyword">let</span> <span class="var">Keystream_2</span>: <span class="type">bitstring</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_2e</span>,<span class="var">TH_2</span>,<span class="fun">emptystring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ15 class="occ">{15}</a> <span class="keyword">let</span> <span class="fun"></span>(=<span class="fun">cred_AS</span>,<span class="var">MAC_2</span>: <span class="type">bitstring</span>) = <span class="fun">xorBreak</span>(<span class="var">ciphertext_2</span>,<span class="var">Keystream_2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ19 class="occ">{19}</a> <span class="keyword">let</span> <span class="var">A</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="var">TH_2</span>,<span class="fun">cred_AS</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ16 class="occ">{16}</a> <span class="keyword">let</span> <span class="var">PRK_3e2m</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="var">PRK_2e</span>,<span class="fun">exp</span>(<span class="var">pubEK_AS</span>,<span class="name">privEK_ED</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ18 class="occ">{18}</a> <span class="keyword">let</span> <span class="var">IV_2m</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m</span>,<span class="var">TH_2</span>,<span class="fun">IV_2m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ17 class="occ">{17}</a> <span class="keyword">let</span> <span class="var">K_2m</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m</span>,<span class="var">TH_2</span>,<span class="fun">K_2m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ20 class="occ">{20}</a> <span class="keyword">if</span> (<span class="fun">AEAD_enc</span>(<span class="var">K_2m</span>,<span class="var">IV_2m</span>,<span class="fun">emptystring</span>,<span class="var">A</span>) <span class="fun">=</span> <span class="var">MAC_2</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ32 class="occ">{32}</a> <span class="keyword">event</span> <span class="fun">EDsendmessage3</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ21 class="occ">{21}</a> <span class="keyword">let</span> <span class="var">TH_3</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">TH_2</span>,<span class="var">ciphertext_2</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ30 class="occ">{30}</a> <span class="keyword">let</span> <span class="var">A_1</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="fun">emptystring</span>,<span class="var">TH_3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ24 class="occ">{24}</a> <span class="keyword">let</span> <span class="var">IV_3m</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m</span>,<span class="var">TH_3</span>,<span class="fun">IV_3m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ22 class="occ">{22}</a> <span class="keyword">let</span> <span class="var">PRK_4x3m</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="var">PRK_3e2m</span>,<span class="fun">exp</span>(<span class="var">pubEK_AS</span>,<span class="name">privEK_ED</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ23 class="occ">{23}</a> <span class="keyword">let</span> <span class="var">K_3m</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m</span>,<span class="var">TH_3</span>,<span class="fun">K_3m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ26 class="occ">{26}</a> <span class="keyword">let</span> <span class="var">MAC_3</span>: <span class="type">bitstring</span> = <span class="fun">AEAD_enc</span>(<span class="var">K_3m</span>,<span class="var">IV_3m</span>,<span class="fun">emptystring</span>,<span class="var">A</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ29 class="occ">{29}</a> <span class="keyword">let</span> <span class="var">P_2</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="fun">cred_ED</span>,<span class="var">MAC_3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ28 class="occ">{28}</a> <span class="keyword">let</span> <span class="var">IV_3ae</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m</span>,<span class="var">TH_3</span>,<span class="fun">IV_3ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ27 class="occ">{27}</a> <span class="keyword">let</span> <span class="var">K_3ae</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m</span>,<span class="var">TH_3</span>,<span class="fun">K_2m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ31 class="occ">{31}</a> <span class="keyword">let</span> <span class="var">ciphertext_3</span>: <span class="type">bitstring</span> = <span class="fun">AEAD_enc</span>(<span class="var">K_3ae</span>,<span class="var">IV_3ae</span>,<span class="var">P_2</span>,<span class="var">A_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ33 class="occ">{33}</a> <span class="keyword">out</span>(<span class="name">c</span>, <span class="var">ciphertext_3</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ34 class="occ">{34}</a> <span class="keyword">in</span>(<span class="name">c</span>, <span class="var">ciphertext_4</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ35 class="occ">{35}</a> <span class="keyword">event</span> <span class="fun">EDgetmessage4</span>(<span class="var">ciphertext_4</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ36 class="occ">{36}</a> <span class="keyword">let</span> <span class="var">TH_4</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">TH_3</span>,<span class="var">ciphertext_3</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ39 class="occ">{39}</a> <span class="keyword">let</span> <span class="var">IV_4ae</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m</span>,<span class="var">TH_4</span>,<span class="fun">IV_4ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ38 class="occ">{38}</a> <span class="keyword">let</span> <span class="var">K_4ae</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m</span>,<span class="var">TH_4</span>,<span class="fun">K_4ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ40 class="occ">{40}</a> <span class="keyword">let</span> =<span class="fun">emptystring</span> = <span class="fun">AEAD_dec</span>(<span class="var">ciphertext_4</span>,<span class="var">K_4ae</span>,<span class="var">IV_4ae</span>,<span class="var">A_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ48 class="occ">{48}</a> <span class="keyword">new</span> <span class="name">message_0</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ50 class="occ">{50}</a> <span class="keyword">new</span> <span class="name">store_downlink_ED</span>: <span class="type">channel</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ51 class="occ">{51}</a> <span class="keyword">new</span> <span class="name">store_uplink_ED</span>: <span class="type">channel</span><br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ54 class="occ">{54}</a> <span class="keyword">new</span> <span class="name">privEK_AS</span>: <span class="type">exponent</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ56 class="occ">{56}</a> <span class="keyword">in</span>(<span class="name">c</span>, <span class="var">m1</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ57 class="occ">{57}</a> <span class="keyword">event</span> <span class="fun">ASgetmessage1</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ53 class="occ">{53}</a> <span class="keyword">let</span> <span class="var">appEUI_2</span>: <span class="type">bitstring</span> = <span class="name">appEUI</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ52 class="occ">{52}</a> <span class="keyword">let</span> <span class="var">devEUI_2</span>: <span class="type">bitstring</span> = <span class="name">devEUI</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ58 class="occ">{58}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">pubEK_ED_1</span>: <span class="type">G</span>,=<span class="var">devEUI_2</span>,=<span class="var">appEUI_2</span>) = <span class="var">m1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ70 class="occ">{70}</a> <span class="keyword">event</span> <span class="fun">ASsendmesage2</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ61 class="occ">{61}</a> <span class="keyword">let</span> <span class="var">PRK_2e_1</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="fun">emptyextractKey</span>,<span class="fun">exp</span>(<span class="var">pubEK_ED_1</span>,<span class="name">privEK_AS</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ59 class="occ">{59}</a> <span class="keyword">let</span> <span class="var">intermediateHash_1</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="var">m1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ55 class="occ">{55}</a> <span class="keyword">let</span> <span class="var">pubEK_AS_1</span>: <span class="type">G</span> = <span class="fun">exp</span>(<span class="fun">g</span>,<span class="name">privEK_AS</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ60 class="occ">{60}</a> <span class="keyword">let</span> <span class="var">TH</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">intermediateHash_1</span>,<span class="var">pubEK_AS_1</span>,<span class="var">appEUI_2</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ68 class="occ">{68}</a> <span class="keyword">let</span> <span class="var">Keystream</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_2e_1</span>,<span class="var">TH</span>,<span class="fun">emptystring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ65 class="occ">{65}</a> <span class="keyword">let</span> <span class="var">A_0</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="var">TH</span>,<span class="fun">cred_AS</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ62 class="occ">{62}</a> <span class="keyword">let</span> <span class="var">PRK_3e2m_1</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="var">PRK_2e_1</span>,<span class="fun">exp</span>(<span class="var">pubEK_ED_1</span>,<span class="name">privEK_AS</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ64 class="occ">{64}</a> <span class="keyword">let</span> <span class="var">IV_2m_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m_1</span>,<span class="var">TH</span>,<span class="fun">IV_2m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ63 class="occ">{63}</a> <span class="keyword">let</span> <span class="var">K_2m_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m_1</span>,<span class="var">TH</span>,<span class="fun">K_2m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ66 class="occ">{66}</a> <span class="keyword">let</span> <span class="var">MAC</span>: <span class="type">bitstring</span> = <span class="fun">AEAD_enc</span>(<span class="var">K_2m_1</span>,<span class="var">IV_2m_1</span>,<span class="fun">emptystring</span>,<span class="var">A_0</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ67 class="occ">{67}</a> <span class="keyword">let</span> <span class="var">P</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="fun">cred_AS</span>,<span class="var">MAC</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ69 class="occ">{69}</a> <span class="keyword">let</span> <span class="var">ciphertext</span>: <span class="type">bitstring</span> = <span class="fun">xor</span>(<span class="var">P</span>,<span class="var">Keystream</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ71 class="occ">{71}</a> <span class="keyword">out</span>(<span class="name">c</span>, <span class="fun"></span>(<span class="var">pubEK_AS_1</span>,<span class="var">appEUI_2</span>,<span class="var">ciphertext</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ72 class="occ">{72}</a> <span class="keyword">in</span>(<span class="name">c</span>, <span class="var">ciphertext_1</span>: <span class="type">bitstring</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ73 class="occ">{73}</a> <span class="keyword">event</span> <span class="fun">ASgetmessage3</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ74 class="occ">{74}</a> <span class="keyword">let</span> <span class="var">TH_1</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">TH</span>,<span class="var">ciphertext</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ80 class="occ">{80}</a> <span class="keyword">let</span> <span class="var">A_2</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="fun">emptystring</span>,<span class="var">TH_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ79 class="occ">{79}</a> <span class="keyword">let</span> <span class="var">IV_3ae_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m_1</span>,<span class="var">TH_1</span>,<span class="fun">IV_3ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ78 class="occ">{78}</a> <span class="keyword">let</span> <span class="var">K_3ae_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m_1</span>,<span class="var">TH_1</span>,<span class="fun">K_3ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ81 class="occ">{81}</a> <span class="keyword">let</span> <span class="fun"></span>(=<span class="fun">cred_ED</span>,<span class="var">MAC_1</span>: <span class="type">bitstring</span>) = <span class="fun">AEAD_dec</span>(<span class="var">ciphertext_1</span>,<span class="var">K_3ae_1</span>,<span class="var">IV_3ae_1</span>,<span class="var">A_2</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ77 class="occ">{77}</a> <span class="keyword">let</span> <span class="var">IV_3m_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_3e2m_1</span>,<span class="var">TH_1</span>,<span class="fun">IV_3m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ75 class="occ">{75}</a> <span class="keyword">let</span> <span class="var">PRK_4x3m_1</span>: <span class="type">extractkey</span> = <span class="fun">HKDFextract</span>(<span class="var">PRK_3e2m_1</span>,<span class="fun">exp</span>(<span class="var">pubEK_ED_1</span>,<span class="name">privEK_AS</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ76 class="occ">{76}</a> <span class="keyword">let</span> <span class="var">K_3m_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m_1</span>,<span class="var">TH_1</span>,<span class="fun">K_3m_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ82 class="occ">{82}</a> <span class="keyword">if</span> (<span class="fun">AEAD_enc</span>(<span class="var">K_3m_1</span>,<span class="var">IV_3m_1</span>,<span class="fun">emptystring</span>,<span class="var">A_2</span>) <span class="fun">=</span> <span class="var">MAC_1</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ86 class="occ">{86}</a> <span class="keyword">let</span> <span class="var">A_3</span>: <span class="type">bitstring</span> = <span class="fun"></span>(<span class="fun">emptystring</span>,<span class="var">TH_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ83 class="occ">{83}</a> <span class="keyword">let</span> <span class="var">TH_5</span>: <span class="type">bitstring</span> = <span class="fun">sha256</span>(<span class="fun"></span>(<span class="var">TH_1</span>,<span class="var">ciphertext_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ85 class="occ">{85}</a> <span class="keyword">let</span> <span class="var">IV_4ae_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m_1</span>,<span class="var">TH_5</span>,<span class="fun">IV_4ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ84 class="occ">{84}</a> <span class="keyword">let</span> <span class="var">K_4ae_1</span>: <span class="type">expandkey</span> = <span class="fun">HKDFexpand</span>(<span class="var">PRK_4x3m_1</span>,<span class="var">TH_5</span>,<span class="fun">K_4ae_constantstring</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ87 class="occ">{87}</a> <span class="keyword">let</span> <span class="var">ciphertext_5</span>: <span class="type">bitstring</span> = <span class="fun">AEAD_enc</span>(<span class="var">K_4ae_1</span>,<span class="var">IV_4ae_1</span>,<span class="fun">emptystring</span>,<span class="var">A_3</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ88 class="occ">{88}</a> <span class="keyword">event</span> <span class="fun">ASsendmesage4</span>(<span class="var">ciphertext_5</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ89 class="occ">{89}</a> <span class="keyword">out</span>(<span class="name">c</span>, <span class="var">ciphertext_5</span>)<br>
)<br>
<br>
</body>
</html>
